# IST REST API

## API endpoints documentation
When the API is running, an autogenerated swagger documentation is available at https://127.0.0.1:8080/cmp/swagger-ui.html

## Helper script
A helper script provides commands to start the application, run tests and more. You can consult the available commands with
```
./api -h
```

### Build and run with a development configuration
This API is mainly based on Java Spring Boot.
To build the source codes and run the application with the **development** configuration :
```
./api up
```
to start up the API application from the source codes. The default base URL is `localhost:8080`.

### Run the unit test
```
./api test
```
## Build and run the application in a production setup
#### Build
To build a self contained executable jar located in ``build/libs/``.
```
./api build
```
#### Run
**Requirements** : Start a Cassandra instance. Refer to [../infrastructure/README.md](../infrastructure/README.md) for more instruction.

To run the application with a production configuration using an external configuration file ``/path/to/application.properties``


```
java -jar  -Dspring.profiles.active=prod  build/libs/scalar-ist-api-0.1.0.jar --spring.config.location=file:/path/to/application.properties
```

The `-Dspring.profiles.active=prod` parameter sets the application global configuration to the `prod` profile. If no external 
configuration file is provided (`--spring.config.location=` parameter is missing),
The configuration file [application-prod.properties](src/main/resources/application-prod.properties) located in the jar 
classpath will be used by default.

To create a custom configuration, copy the [application-prod.properties](src/main/resources/application-prod.properties) content and update the values of the configuration keys. When starting the application, set the path to the created file with this parameter ``--spring.config.location=file:/path/to/application.properties``

## Appendix
#### Generate certificate and key for local HTTPS configuration
This will generate a pkcs12 keystore containing the certificate and the key for the API running on localhost
```
keytool -genkeypair -alias scalar -keyalg RSA -keysize 2048 -storetype PKCS12 -keystore ist_api.p12 -storepass scalar -validity 3650 -dname "cn=localhost" -ext san=dns:localhost -ext ku=digitalSignature -ext eku=serverAuth
```
